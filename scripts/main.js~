jQuery(function() {
    var $input = jQuery('#xmlInput'),
        $parse = jQuery('#parse'),
        $graph = jQuery('#graphContainer'),
	$parsedRDF = jQuery('#parsedRDF code'),
	$graphData = jQuery('#graphData code');

    function dataChanged() {
	draw(parse());
    }

    function parse() {
	var data = jQuery.rdfParser.parse($input.val()),
	    graphData = jQuery.rdfGrapher.parse(data);

	$parsedRDF.html(JSON.stringify(data, null, 4));
	$graphData.html(JSON.stringify(graphData, null, 4));

	return graphData;
    };

    function draw(graphData) {
	jQuery.rdfGraph.draw(graphData);
    };

    $parse.click(function() {
        dataChanged();
    });

    $input.change(function(){
        dataChanged();
    });

    dataChanged();
});
